---
- !policy
  id: cust-portal
  annotations:
    description: This policy defines the identity structure for the application
  body:
  - !layer webservers
  - !layer appservers
  - !layer secretless

# add authn identity layer to application layer so authn role inherits app's permissions
- !grant
  role: !layer cust-portal/webservers
  members:
  - !host /conjur/authn-k8s/demo-cluster/apps/cust-portal/service_account/ocp-webserver
  - !host /conjur/authn-k8s/demo-cluster/apps/cust-portal/service_account/k8s-webserver

- !grant
  role: !layer cust-portal/appservers
  members:
  - !host /conjur/authn-k8s/demo-cluster/apps/cust-portal/service_account/ocp-appserver
  - !host /conjur/authn-k8s/demo-cluster/apps/cust-portal/service_account/k8s-appserver

- !grant
  role: !layer cust-portal/secretless
  members:
  - !host /conjur/authn-k8s/demo-cluster/apps/cust-portal/service_account/ocp-secretless-broker
  - !host /conjur/authn-k8s/demo-cluster/apps/cust-portal/service_account/k8s-secretless-broker

