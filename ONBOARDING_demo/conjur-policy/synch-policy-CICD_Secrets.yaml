---
# Pre-loaded synchronizer policies for a project.
# All secrets for the project are in CICD_Secrets
# Before synchronizer runs, host identity is granted consumer role for secrets.

#########################
# Vault RBAC
# - updates vault policy with LOB admin group
- !policy
  id: DemoVault
  body:
  - !group CICD-admins

  #########################
  # LOB RBAC
  # - creates LOB policy owned by LOB admin group
  # - creates safe admin group
  - !policy
    id: CICD
    owner: !group /DemoVault/CICD-admins
    body:
    - !group CICD_Secrets-admins

    #########################
    # Safe RBAC
    # - creates empty sub-policy for safe
    # - creates delegation sub-policy w/ consumers group 
    - !policy
      id: CICD_Secrets
      body:
      - !policy
        id: delegation
        owner: !group /DemoVault/CICD/CICD_Secrets-admins
        body:
        - !group consumers

        # grant safe consumer role to host identity
        - !grant
          role: !group consumers
          member: !layer /client/nodes
