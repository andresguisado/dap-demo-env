---
# Pre-loaded synchronizer policies for a project.
# All secrets for the project are in XXTestSafe7
# Before synchronizer runs, host identity is granted consumer role for secrets.

#########################
# Vault RBAC
# - updates vault policy with LOB admin group
- !policy
  id: DemoVault
  body:
  - !group CICD-admins

  #########################
  # LOB RBAC
  # - creates LOB policy owned by LOB admin group
  # - creates safe admin group
  - !policy
    id: CICD
    owner: !group /DemoVault/CICD-admins
    body:
    - !group XXTestSafe7-admins

    #########################
    # Safe RBAC
    # - creates empty sub-policy for safe
    # - creates delegation sub-policy w/ consumers group 
    - !policy
      id: XXTestSafe7
      body:
      - !policy
        id: delegation
        owner: !group /DemoVault/CICD/XXTestSafe7-admins
        body:
        - !group consumers

#########################
# Host identity RBAC
# - creates host/group/layer role identities
# - grants safe consumer role to identities

# create host identity
- !host client/node

# grant safe consumer role to host identities
- !grant
  role: !group DemoVault/CICD/XXTestSafe7/delegation/consumers
  member: !host client/node
# member: !group <group-of-identities>
# member: !layer <layer-of-identities>
