#!/bin/bash

CONJUR_APPLIANCE_URL=https://conjur-follower.$CONJUR_NAMESPACE_NAME.svc.cluster.local
CONJUR_AUTHN_URL=$CONJUR_APPLIANCE_URL/api/authn-k8s/$AUTHENTICATOR_ID 
CONJUR_AUTHN_LOGIN=host/conjur/authn-k8s/$AUTHENTICATOR_ID/apps/$TEST_APP_NAMESPACE_NAME/service_account/k8s-appserver

cat << EOL | kubectl -n ${TEST_APP_NAMESPACE_NAME} apply -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: conjur
data:
  CONJUR_ACCOUNT: "${CONJUR_ACCOUNT}"
  CONJUR_VERSION: "${CONJUR_VERSION}"
  CONJUR_APPLIANCE_URL: "${CONJUR_APPLIANCE_URL}"
  CONJUR_AUTHN_URL: "${CONJUR_AUTHN_URL}"
  CONJUR_SSL_CERTIFICATE: "$(cat "$CONJUR_CERT_FILE")"
  CONJUR_AUTHN_LOGIN: "${CONJUR_AUTHN_LOGIN}"
EOL
